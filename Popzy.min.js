const $$=document.querySelectorAll.bind(document);const $=document.querySelector.bind(document);Popzy.elements=[];function Popzy(option={}){if(!option.content&&!option.templateId){return console.warn("cung cấp dữ liệu truyền vào")}else if(option.content&&option.templateId){option.templateID=null}else if(option.templateId){this.template=$(`#${option.templateId}`);if(!this.template){return console.error(`#${option.templateId} does not exits`)}}else if(option.content){this.content=option.content}this.opt=Object.assign({enablescroll:true,footer:false,destroyOnclose:true,closeModal:["buttonModal","overlay","Escape"],cssElement:[],ScrollLockTarget:()=>document.body},option);const{closeModal:closeModal}=this.opt;this._allowButtonclose=closeModal.includes("buttonModal");this._allowoverlayclose=closeModal.includes("overlay");this._allowEscapeclose=closeModal.includes("Escape");this._footerButton=[];this._handleEscapeKey=this._handleEscapeKey.bind(this)}Popzy.prototype._build=function(){const contentNode=this.content?document.createElement("div"):this.template.content.cloneNode(true);if(this.content){contentNode.innerHTML=this.content}this.backup=document.createElement("div");this.backup.className="popzy";const container=document.createElement("div");container.className="popzy__background";this.opt.cssElement.forEach(css=>{if(typeof css==="string"){container.classList.add(css)}});if(this._allowButtonclose){const close=this._createButton("&times;","popzy__close",()=>this.closeModal());container.append(close)}const contentModal=document.createElement("div");contentModal.className="popzy__content";contentModal.append(contentNode);container.append(contentModal);if(this.opt.footer){this._footerModal=document.createElement("div");this._footerModal.classList.add("popzy__footer");this._renderFooterModal();this._renderFooterButton();container.append(this._footerModal)}this.backup.append(container);document.body.append(this.backup)};Popzy.prototype.setFooterModal=function(html){this._footer=html;this._renderFooterModal()};Popzy.prototype._createButton=function(title,cssClass,callback){const button=document.createElement("button");button.innerHTML=title,button.className=cssClass,button.onclick=callback;return button};Popzy.prototype.addFooter=function(title,cssClass,callback){const button=this._createButton(title,cssClass,callback);this._footerButton.push(button);this._renderFooterButton()};Popzy.prototype._renderFooterButton=function(){if(this._footerModal){this._footerButton.forEach(button=>{this._footerModal.append(button)})}};Popzy.prototype._renderFooterModal=function(){if(this._footerModal&&this._footer){this._footerModal.innerHTML=this._footer}};Popzy.prototype._getscrollbar=function(){if(this._scroll)return this._scroll;const div=document.createElement("div");Object.assign(div.style,{position:"absolute",overflow:"scroll",top:"-999px"});document.body.appendChild(div);this._scroll=div.offsetWidth-div.clientWidth;console.log(`tinh toán kích thước thanh cuộn ${this._scroll}`);document.body.removeChild(div);return this._scroll};Popzy.prototype.open=function(){Popzy.elements.push(this);if(!this.backup){this._build()}setTimeout(()=>{this.backup.classList.add("popzy--show")},0);this.ontransitionEnd(this.opt.onOpen);if(this._allowoverlayclose){this.backup.onclick=e=>{if(e.target===this.backup){this.closeModal()}}}if(this._allowEscapeclose){document.addEventListener("keydown",this._handleEscapeKey)}if(this.opt.enablescroll){const target=this.opt.ScrollLockTarget();if(this._hasscrollbar(target)){target.classList.add("popzy--no-scroll");const pad=parseInt(getComputedStyle(target).paddingRight);target.style.paddingRight=pad+this._getscrollbar()+"px"}}return this.backup};Popzy.prototype._handleEscapeKey=function(e){console.log(this);const lastModal=Popzy.elements[Popzy.elements.length-1];if(e.key==="Escape"&&this===lastModal){this.closeModal()}};Popzy.prototype.ontransitionEnd=function(callback){this.backup.ontransitionend=e=>{if(e.propertyName!=="transform"){return}if(typeof callback==="function"){callback()}}};Popzy.prototype.closeModal=function(destroy=this.opt.destroyOnclose){Popzy.elements.pop();this.backup.classList.remove("popzy--show");if(this._allowEscapeclose){document.removeEventListener("keydown",this._handleEscapeKey)}this.ontransitionEnd(()=>{if(destroy){this.backup.remove();this.backup=null;this._footerModal=null}if(typeof this.opt.onClose==="function"){this.opt.onClose()}if(this.opt.enablescroll&&!Popzy.elements.length){const target=this.opt.ScrollLockTarget();target.classList.remove("popzy--no-scroll");target.style.paddingRight=""}})};Popzy.prototype._hasscrollbar=target=>{if([document.documentElement,document.body].includes(target)){return document.documentElement.scrollHeight>document.documentElement.clientHeight||document.body.scrollHeight>document.body.clientHeight}return target.scrollHeight>target.clientHeight};